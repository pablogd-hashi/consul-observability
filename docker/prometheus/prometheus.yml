global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:

  - job_name: consul
    metrics_path: /v1/agent/metrics
    params:
      format: [prometheus]
    static_configs:
      - targets:
          - consul:8500
    relabel_configs:
      - target_label: instance
        replacement: consul

  - job_name: envoy
    metrics_path: /stats/prometheus
    static_configs:
      - targets:
          - envoy:20200
    relabel_configs:
      - target_label: instance
        replacement: envoy

  # Scrape the OTel collector's own internal metrics
  - job_name: otel-collector
    metrics_path: /metrics
    static_configs:
      - targets:
          - otel-collector:8888
    relabel_configs:
      - target_label: instance
        replacement: otel-collector

  # Scrape service-graph topology metrics derived from traces.
  # The OTel servicegraphconnector emits:
  #   traces_service_graph_request_total{client="web",server="api",...}
  # These power the "Service Dependency Map" node graph panel in Grafana
  # and represent the full web→api→[payments,cache]→currency topology.
  - job_name: servicegraph
    metrics_path: /metrics
    static_configs:
      - targets:
          - otel-collector:8889
    relabel_configs:
      - target_label: instance
        replacement: otel-collector-servicegraph
